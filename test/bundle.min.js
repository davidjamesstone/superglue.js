(function e(t,r,n){function i(s,o){if(!r[s]){if(!t[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(e,t,r){(function(e){if(Array.prototype.find)return;var t=function(e){var t=Object(this);var r=t.length<0?0:t.length>>>0;if(r===0)return undefined;if(typeof e!=="function"||Object.prototype.toString.call(e)!=="[object Function]"){throw new TypeError("Array#find: predicate must be a function")}var n=arguments[1];for(var i=0,a;i<r;i++){a=t[i];if(e.call(n,a,i,t))return a}return undefined};if(Object.defineProperty){try{Object.defineProperty(Array.prototype,"find",{value:t,configurable:true,enumerable:false,writable:true})}catch(e){}}if(!Array.prototype.find){Array.prototype.find=t}})(this)},{}],2:[function(e,t,r){(function(e){if(Array.prototype.findIndex)return;var t=function(e){var t=Object(this);var r=Math.max(0,t.length)>>>0;if(r===0)return-1;if(typeof e!=="function"||Object.prototype.toString.call(e)!=="[object Function]"){throw new TypeError("Array#findIndex: predicate must be a function")}var n=arguments.length>1?arguments[1]:undefined;for(var i=0;i<r;i++){if(e.call(n,t[i],i,t))return i}return-1};if(Object.defineProperty){try{Object.defineProperty(Array.prototype,"findIndex",{value:t,configurable:true,writable:true})}catch(e){}}if(!Array.prototype.findIndex){Array.prototype.findIndex=t}})(this)},{}],3:[function(e,t,r){t.exports=e("./lib/supermodels")},{"./lib/supermodels":13}],4:[function(e,t,r){"use strict";var n=e("./util");var i=e("./factory");function a(e){var t=n.isConstructor(e);var r=n.isSupermodelConstructor(e);var i=n.isArray(e);if(t||r||i){return{__type:e}}var a=!n.isObject(e);if(a){return{__value:e}}return e}function s(e){e=a(e);var t="__validators";var r="__value";var o="__type";var u="__displayName";var l="__get";var c="__set";var f="__enumerable";var p="__configurable";var h="__writable";var d=[t,r,o,u,l,c,f,p,h];var v={from:e,type:e[o],value:e[r],validators:e[t]||[],enumerable:e[f]!==false,configurable:!!e[p],writable:e[h]!==false,displayName:e[u],getter:e[l],setter:e[c]};var m=v.type;if(n.isSimpleConstructor(m)){v.isSimple=true;v.cast=function(e){return n.cast(e,m)}}else if(n.isSupermodelConstructor(m)){v.isReference=true}else if(v.value){v.isSimple=true}else{var _=Object.keys(e);var y=_.filter(function(e){return d.indexOf(e)===-1});if(y.length){var g={};var b;y.forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);var i;if(r.get||r.set){i={__get:r.get,__set:r.set}}else{i=e[t]}if(!n.isConstructor(i)&&!n.isSupermodelConstructor(i)&&n.isFunction(i)){if(!b){b={}}b[t]=i}else{g[t]=s(i)}});v.defs=g;v.proto=b}if(m===Array||n.isArray(m)){v.isArray=true;if(m.length>0){v.def=s(m[0])}}else if(y.length===0){v.isSimple=true}}v.create=i(v);return v}t.exports=s},{"./factory":8,"./util":14}],5:[function(e,t,r){"use strict";t.exports=function(e){var t=[];var r=function(){var r=Array.prototype.pop.apply(t);e("pop",t,{value:r});return r};var n=function(){var r=Array.prototype.push.apply(t,arguments);e("push",t,{value:r});return r};var i=function(){var r=Array.prototype.shift.apply(t);e("shift",t,{value:r});return r};var a=function(){var r=Array.prototype.sort.apply(t,arguments);e("sort",t,{value:r});return r};var s=function(){var r=Array.prototype.unshift.apply(t,arguments);e("unshift",t,{value:r});return r};var o=function(){var r=Array.prototype.reverse.apply(t);e("reverse",t,{value:r});return r};var u=function(){if(!arguments.length){return}var r=Array.prototype.splice.apply(t,arguments);e("splice",t,{value:r,removed:r,added:Array.prototype.slice.call(arguments,2)});return r};t.pop=t.pop&&r;t.push=t.push&&n;t.shift=t.shift&&i;t.unshift=t.unshift&&s;t.sort=t.sort&&a;t.reverse=t.reverse&&o;t.splice=t.splice&&u;t.update=function(r,n){var i=t[r];var a=t[r]=n;e("update",t,{index:r,value:a,oldValue:i});return a};return t}},{}],6:[function(e,t,r){"use strict";t.exports=function e(t,r,n,i){this.name=t;this.path=r;this.target=n;if(i){this.detail=i}}},{}],7:[function(e,t,r){"use strict";t.exports=n;function n(e){var t=e||this;if(e){t=i(e);return t}}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){(this.__callbacks[e]=this.__callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeEventListener=n.prototype.removeAllListeners=function(e,t){if(arguments.length===0){this.__callbacks={};return this}var r=this.__callbacks[e];if(!r){return this}if(arguments.length===1){delete this.__callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){var t=[].slice.call(arguments,1);var r=this.__callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){return this.__callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],8:[function(e,t,r){"use strict";var n=e("./util");var i=e("./proto");var a=e("./wrapper");function s(e,t){var r={};var n={__:{value:r},__def:{value:e},__parent:{value:t,writable:true},__callbacks:{value:{},writable:true}};return n}function o(e){var t=e.__def.defs;for(var r in t){u(e,r,t[r])}}function u(e,t,r){var n={get:function(){return this.__get(t)},enumerable:r.enumerable,configurable:r.configurable};if(r.writable){n.set=function(e){this.__setNotifyChange(t,e)}}Object.defineProperty(e,t,n);e.__[t]=r.create(e)}function l(e){var t,r,u;if(e.isSimple){t=new a(e.value,e.writable,e.validators,e.getter,e.setter,e.cast,null)}else if(e.isReference){var l=e.type.def;if(l.isSimple){t=new a(l.value,l.writable,l.validators,e.getter,e.setter,l.cast,null)}else{u=function(e){var t=false;if(n.isNullOrUndefined(e)){t=true}else{t=l===e.__def}if(!t){throw new Error("Value should be an instance of the referenced model, null or undefined")}};t=new a(e.value,e.writable,e.validators,e.getter,e.setter,null,u)}}else if(e.isArray){r=function(t){var r=i(e);Object.defineProperties(r,s(e,t));o(r);return r};u=function(e){if(!n.isArray(e)){throw new Error("Value should be an array")}};t=new a(r,e.writable,e.validators,e.getter,e.setter,null,u)}else{var c=i(e);r=function(t){var r=Object.create(c,s(e,t));o(r);return r};u=function(e){if(!c.isPrototypeOf(e)){throw new Error("Invalid prototype")}};t=new a(r,e.writable,e.validators,e.getter,e.setter,null,u)}var f=function(e){var r=Object.create(t);r.initialize(e);return r};f.wrapper=t;return f}t.exports=l},{"./proto":11,"./util":14,"./wrapper":16}],9:[function(e,t,r){"use strict";function n(e,t){var r=e.__def.isArray;var i=e.__def.defs;var a,s,o,u,l,c,f;if(i){a=Object.keys(i);for(u=0;u<a.length;u++){o=a[u];if(t.hasOwnProperty(o)){s=i[o];l=s.isSimple;c=s.isReference&&s.type.def.isSimple;f=s.isReference&&t[o]&&t[o].__supermodel;if(l||c||f){e[o]=t[o]}else if(t[o]){if(s.isReference){e[o]=s.type()}n(e[o],t[o])}}}}if(r&&Array.isArray(t)){for(u=0;u<t.length;u++){var p=e.create();e.push(p&&p.__supermodel?n(p,t[u]):t[u])}}return e}t.exports=n},{}],10:[function(e,t,r){"use strict";var n=e("./emitter-event");var i=e("./validation-error");var a=e("./wrapper");var s=e("./merge");var o={__supermodel:{value:true},__keys:{get:function(){var e=Object.keys(this);if(Array.isArray(this)){var t=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create","__merge","__setNotifyChange","__notifyChange","__set","__get","__chain","__relativePath"];e=e.filter(function(e){return t.indexOf(e)<0})}return e}},__name:{get:function(){if(this.__isRoot){return""}var e=this.__parent.__keys;var t,r;for(var n=0;n<e.length;n++){t=e[n];r=this.__parent[t];if(r===this){return t}}}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__isRoot:{get:function(){return!this.__hasAncestors}},__children:{get:function(){var e=[];var t=this.__keys;var r,n;for(var i=0;i<t.length;i++){r=t[i];n=this[r];if(n&&n.__supermodel){e.push(n)}}return e}},__ancestors:{get:function(){var e=[];var t=this;while(t.__parent){e.push(t.__parent);t=t.__parent}return e}},__descendants:{get:function(){var e=[];function t(r){var n=r.__keys;var i,a;for(var s=0;s<n.length;s++){i=n[s];a=r[i];if(a&&a.__supermodel){e.push(a);t(a)}}}t(this);return e}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__hasDescendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var e=[];var t=this.__def;var r,n,s,o;var u=t.validators.slice(0);for(s=0;s<u.length;s++){r=u[s];n=r.call(this,this);if(n){e.push(new i(this,n,r))}}var l=this.__keys;var c,f,p;for(s=0;s<l.length;s++){f=l[s];if(t.isArray&&t.def&&(!t.defs||!(f in t.defs))){p=t.def;if(p.isSimple){c=p.create.wrapper;c.setValue(this[f])}else if(p.isReference&&p.type.def.isSimple){c=p.type.def.create.wrapper;c.setValue(this[f])}else{c=this[f]}}else{c=this.__[f]}if(c){if(c.__supermodel){Array.prototype.push.apply(e,c.errors)}else if(c instanceof a){var h=c.getValue(this);if(h&&h.__supermodel){Array.prototype.push.apply(e,h.errors)}else{var d=c.validators;for(o=0;o<d.length;o++){r=d[o];n=r.call(this,h,f);if(n){e.push(new i(this,n,r,f))}}}}}}return e}}};var u={__get:function(e){return this.__[e].getValue(this)},__set:function(e,t){this.__[e].setValue(t,this)},__relativePath:function(e,t){var r=this.__path?e.substr(this.__path.length+1):e;if(r){return t?r+"."+t:r}return t},__chain:function(e){return[this].concat(this.__ancestors).forEach(e)},__merge:function(e){return s(this,e)},__notifyChange:function(e,t,r){var i=this;var a=this.__path;var s="set";var o={oldValue:r,newValue:t};this.emit(s,new n(s,e,i,o));this.emit("change",new n(s,e,i,o));this.emit("change:"+e,new n(s,e,i,o));this.__ancestors.forEach(function(t){var r=t.__relativePath(a,e);t.emit("change",new n(s,r,i,o))})},__setNotifyChange:function(e,t){var r=this.__get(e);this.__set(e,t);var n=this.__get(e);this.__notifyChange(e,n,r)}};t.exports={proto:u,descriptors:o}},{"./emitter-event":6,"./merge":9,"./validation-error":15,"./wrapper":16}],11:[function(e,t,r){"use strict";var n=e("./emitter-object");var i=e("./emitter-array");var a=e("./emitter-event");var s=e("./util").extend;var o=e("./model");var u=o.proto;var l=o.descriptors;var c=Object.create(u,l);var f=function(){var e=Object.create(c);n(e);return e}();function p(){var e=i(function(e,t,r){if(e==="update"){t.__notifyChange(r.index,r.value,r.oldValue)}else{var n=t;var i=t.__path;var s=r;var o=r.index;t.emit(e,new a(e,"",n,s));t.emit("change",new a(e,"",n,s));t.__ancestors.forEach(function(t){var r=t.__relativePath(i,o);t.emit("change",new a(e,r,n,s))})}});Object.defineProperties(e,l);n(e);s(e,u);return e}function h(e){var t=Object.create(f);if(e){s(t,e)}return t}function d(e,t){var r=p();if(e){s(r,e)}if(t){var n=t.create.wrapper;v(r,n);r.create=function(){return t.isReference?t.type():t.create().getValue(this)}}return r}function v(e,t){function r(r){var n=[];for(var i=0;i<r.length;i++){t.setValue(r[i],e);n.push(t.getValue(e))}return n}var n=e.push;var i=e.unshift;var a=e.splice;var s=e.update;if(n){e.push=function(){var t=r(arguments);return n.apply(e,t)}}if(i){e.unshift=function(){var t=r(arguments);return i.apply(e,t)}}if(a){e.splice=function(){var t=r(Array.prototype.slice.call(arguments,2));t.unshift(arguments[1]);t.unshift(arguments[0]);return a.apply(e,t)}}if(s){e.update=function(){var t=r([arguments[1]]);t.unshift(arguments[0]);return s.apply(e,t)}}}function m(e){return e.isArray?d(e.proto,e.def):h(e.proto)}t.exports=m},{"./emitter-array":5,"./emitter-event":6,"./emitter-object":7,"./model":10,"./util":14}],12:[function(e,t,r){"use strict";t.exports={}},{}],13:[function(e,t,r){"use strict";var n=e("./def");var i=e("./supermodel");function a(e,t){var r=n(e);function a(e){var n=r.isSimple?r.create():r.create().getValue({});if(t){t.apply(n,arguments)}else if(e){n.__merge(e)}return n}Object.defineProperty(a,"def",{value:r});a.prototype=i;a.constructor=a;return a}t.exports=a},{"./def":4,"./supermodel":12}],14:[function(e,t,r){"use strict";var n=e("./supermodel");function i(e,t){if(!t||typeof t!=="object"){return e}var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}var a={extend:i,typeOf:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(e){return this.typeOf(e)==="object"},isArray:function(e){return Array.isArray(e)},isSimple:function(e){return!this.isObject(e)&&!this.isArray(e)},isFunction:function(e){return this.typeOf(e)==="function"},isDate:function(e){return this.typeOf(e)==="date"},isNull:function(e){return e===null},isUndefined:function(e){return typeof e==="undefined"},isNullOrUndefined:function(e){return this.isNull(e)||this.isUndefined(e)},cast:function(e,t){if(!t){return e}switch(t){case String:return a.castString(e);case Number:return a.castNumber(e);case Boolean:return a.castBoolean(e);case Date:return a.castDate(e);case Object:case Function:return e;default:throw new Error("Invalid cast")}},castString:function(e){if(e===undefined||e===null||a.typeOf(e)==="string"){return e}return e.toString&&e.toString()},castNumber:function(e){if(e===undefined||e===null){return NaN}if(a.typeOf(e)==="number"){return e}return Number(e)},castBoolean:function(e){if(!e){return false}var t=["0","false","off","no"];return t.indexOf(e)===-1},castDate:function(e){if(e===undefined||e===null||a.typeOf(e)==="date"){return e}return new Date(e)},isConstructor:function(e){return this.isSimpleConstructor(e)||[Array,Object].indexOf(e)>-1},isSimpleConstructor:function(e){return[String,Number,Date,Boolean].indexOf(e)>-1},isSupermodelConstructor:function(e){return this.isFunction(e)&&e.prototype===n}};t.exports=a},{"./supermodel":12}],15:[function(e,t,r){"use strict";function n(e,t,r,n){this.target=e;this.error=t;this.validator=r;if(n){this.key=n}}t.exports=n},{}],16:[function(e,t,r){"use strict";var n=e("./util");function i(e,t,r,i,a,s,o){this.validators=r;this._defaultValue=e;this._writable=t;this._getter=i;this._setter=a;this._beforeSet=s;this._assert=o;this.isInitialized=false;if(!n.isFunction(e)){this.isInitialized=true;if(!n.isUndefined(e)){this._value=e}}}i.prototype.initialize=function(e){if(this.isInitialized){return}this.setValue(this._defaultValue(e),e);this.isInitialized=true};i.prototype.getValue=function(e){return this._getter?this._getter.call(e):this._value};i.prototype.setValue=function(e,t){if(!this._writable){throw new Error("Value is readonly")}if(e&&e.__supermodel&&t){if(e.__parent!==t){e.__parent=t}}var r;if(this._setter){this._setter.call(t,e);r=this.getValue(t)}else{r=this._beforeSet?this._beforeSet(e):e}if(this._assert){this._assert(r)}this._value=r};t.exports=i},{"./util":14}],17:[function(e,t,r){t.exports={items:[{productId:"1",quantity:2},{productId:"2",quantity:5},{productId:"3",quantity:1}]}},{}],18:[function(e,t,r){e("array.prototype.find");e("array.prototype.findindex");var n=e("supermodels.js");var i=e("./template.html");var a=e("./products-data");var s=e("./basket-data");var o={productId:String,productName:String,price:Number,image:String,discountPercent:Number,get cost(){return this.price-this.price*this.discountPercent}};var u=[o];var l={items:[{productId:String,quantity:Number,get cost(){var e=this.product;return this.quantity*(e.price-e.price*e.discountPercent)},get product(){var e=this.productId;return this.__ancestors[this.__ancestors.length-1].products.filter(function(t){return t.productId===e})[0]}}],get totalCost(){var e=0;for(var t=0,r=this.items.length;t<r;t++){e+=this.items[t].cost}return e},get totalQuantity(){var e=0;for(var t=0,r=this.items.length;t<r;t++){e+=this.items[t].quantity}return e}};var c=n(l);var f=n(u);var p={basket:c,products:f};var h=n(p);var d=new h({basket:new c(s),products:new f(a)});var v=document.getElementById("mount");function m(){patch(v,i,d)}m();window.app=d;d.on("change",m)},{"./basket-data":17,"./products-data":20,"./template.html":21,"array.prototype.find":1,"array.prototype.findindex":2,"supermodels.js":3}],19:[function(e,t,r){},{}],20:[function(e,t,r){t.exports=[{productId:"1",productName:"Apple iPod touch 32GB 5th Generation - White",price:189.49,discountPercent:0,image:"http://ecx.images-amazon.com/images/I/31Y0DrM4ZNL._SY355_.jpg"},{productId:"2",productName:"Samsung Galaxy Tab 3 7-inch - (Black, Wi-Fi)",price:109.95,discountPercent:.2,image:"http://ecx.images-amazon.com/images/I/81aaDjlcU4L._SL1500_.jpg"},{productId:"3",productName:"Bose QuietComfort 20 Acoustic Noise Cancelling Headphones",price:255,discountPercent:.13,image:"http://ecx.images-amazon.com/images/I/61XaVWVyNNL._SL1500_.jpg"}]},{}],21:[function(e,t,r){t.exports=function(t){var r=t.basket;var n=t.products;var i=e("./lines-summary");var a=e("./total-summary");function s(e){var t=r.items;var n=t.find(function(t){return t.productId===e.productId});if(n){n.quantity++}else{var i=t.create();i.productId=e.productId;i.quantity=1;t.push(i)}}function o(e){r.items.splice(e,1)}elementOpen("table");elementOpen("thead");elementOpen("tr");elementOpen("th");text("productId");elementClose("th");elementOpen("th");text("productName");elementClose("th");elementOpen("th");text("quantity");elementClose("th");elementOpen("th");text("price");elementClose("th");elementOpen("th");text("discountPercent");elementClose("th");elementOpen("th");text("cost");elementClose("th");elementOpen("th");i(r);elementClose("th");elementClose("tr");elementClose("thead");elementOpen("tbody");(Array.isArray(r.items)?r.items:Object.keys(r.items)).forEach(function(e,t){elementOpen("tr",e.id);elementOpen("td",null,null,"onclick",s);text(""+e.product.productId+"");elementClose("td");elementOpen("td");text(""+e.product.productName+"");elementClose("td");elementOpen("td");elementOpen("input",null,["type","number","onchange",function(t){e.quantity=this.value}],"value",e.quantity);elementClose("input");elementClose("td");elementOpen("td");text(""+e.product.price+"");elementClose("td");elementOpen("td");text(""+e.product.discountPercent*100+" %"+"");elementClose("td");elementOpen("td");text(""+e.cost.toFixed(2)+"");elementClose("td");elementOpen("td");elementOpen("button",null,["onclick",function(e){o(t)}]);text("Remove");elementClose("button");elementClose("td");elementClose("tr")},r.items);elementOpen("tbody");a(r);if(r.items.length){text("             I'm in an `if` attribute "+r.totalCost+"           ")}elementClose("tbody");elementClose("tbody");elementClose("table");(Array.isArray(n)?n:Object.keys(n)).forEach(function(e,t){elementOpen("div",t,["style","width: 33%; float: left;"]);elementOpen("div");text(""+e.productId+"");elementClose("div");elementOpen("div");text(""+e.productName+"");elementClose("div");elementOpen("div");text(""+e.price+"");elementClose("div");elementOpen("div");text(""+e.discountPercent*100+" %"+"");elementClose("div");elementOpen("div");text(""+e.cost.toFixed(2)+"");elementClose("div");elementOpen("img",null,["style","max-width: 240px; max-height: 200px;"],"src",e.image);elementClose("img");elementOpen("button",null,["onclick",function(t){s(e)}]);text("Add to basket");elementClose("button");elementClose("div")},n);(Array.isArray(t)?t:Object.keys(t)).forEach(function(e,r){elementOpen("div",e);elementOpen("span");text(""+e+"");elementClose("span");elementOpen("span");text(""+r+"");elementClose("span");elementOpen("span");text(""+t[e]+"");elementClose("span");elementClose("div")},t)}},{"./lines-summary":19,"./total-summary":22}],22:[function(e,t,r){t.exports=function e(t){elementOpen("tfoot");elementOpen("tr");elementOpen("td");elementOpen("h3");text(""+t.totalCost.toFixed(2)+"");elementClose("h3");elementClose("td");elementClose("tr");elementClose("tfoot")}},{}]},{},[18]);