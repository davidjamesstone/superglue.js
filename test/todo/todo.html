<script>

var todos = model

function add (e) {
  e.preventDefault();
  var newTodo = todos.create()
  newTodo.text = this.newTodo.value;
  todos.push(newTodo)
  this.newTodo.select()
}

function clearCompleted (index) {
  var len = todos.length
  for (var i = len - 1; i >= 0; i--) {
    if (todos[i].completed) {
      todos.splice(i, 1)
    }
  }
}

// function toggleCompleted () {
//   var state = this.checked
//   todos.forEach(function(todo) {
//     todo.completed = state
//   })
// }

function totalCompleted () {
  return todos.filter(function (todo) {
    return todo.completed
  }).length
}

</script>

<table>
  <thead>
    <tr>
      <td></td>
      <td>
        <form onsubmit="{add}">
          <input type="text" name="newTodo" placeholder="Enter new todo">
        </form>
      </td>
      <!-- <td><input type="checkbox" onchange="{toggleCompleted}"></td> -->
    </tr>
  </thead>
  <tbody>
  <tr each="todo, todo.id in todos">
    <td>{$index + 1}.</td>
    <td><input type="text" value="{todo.text}" onkeyup="{=> todo.text = this.value}" style="{ borderColor: todo.text ? '': 'red', textDecoration: todo.completed ? 'line-through': '' }"></td>
    <td><input type="checkbox" checked="{todo.completed || undefined}" onchange="{=> todo.completed = this.checked}"></td>
  <tr>
  </tbody>
  <tfoot>
    <tr>
      <td>Total {todos.length}</td>
      <td></td>
      <td><button onclick="{clearCompleted}">Clear completed {totalCompleted()}</button></td>
    </tr>
  </tfoot>
</table>

<pre>{JSON.stringify(todos, null, 2)}</pre>
